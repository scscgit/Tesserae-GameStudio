<?xml version="1.0" encoding="UTF-8"?>

<ui:composition template="/WEB-INF/templates/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:g="http://www.tuke.sk/games"
                xmlns:p="http://primefaces.org/ui"
>

    <ui:param name="gameName" value="Tesserae"/>

    <ui:define name="style">
        <h:outputStylesheet library="css" name="tesserae.css"/>
    </ui:define>

    <ui:define name="javascript">
        <script type="text/javascript">
            //<![CDATA[
            try {
                //Scripts launched on page load
                $(document).ready(function () {
                    $('#scoreTable').DataTable({
                        columns: [
                            {data: "player"},
                            {data: "points"},
                            {data: "playedOn"}
                        ],
                        ajax: {url: "webapi/score/mines", dataSrc: ''}
                    });

                    $('#favoriteGameTable').DataTable({
                        columns: [
                            {data: "player"},
                            {data: "game"},
                            {data: "chosenOn"}
                        ],
                        ajax: {
                            url: "webapi/favoritegame/player/" + "Steve"/*$('label#userName').getAttribute('value')*/, //todo username
                            dataSrc: ''
                        }
                    });

                    //Text areas will scale dynamically
                    autosize($('#fieldMessageArea'));

                    //Autofocus for the input command area
                    window.onload = function () {
                        var cmds = document.getElementById("tesseraeform:fieldCommandArea");
                        cmds.focus();
                        cmds.setAttribute("value", "");
                        return "";
                    }
                });
            } catch (e) {
                //Actual life-hack, catch stack overflow
                window.location.replace("http://stackoverflow.com/search?q=[js] + " + e.message);
            }
            //]]>
        </script>
    </ui:define>

    <ui:define name="content">
        <h:form id="tesseraeform" styleClass="gameForm">

            <g:tesserae textOnly="true" value="#{tesseraemanager}">
            </g:tesserae>

            <!-- Message from the Player -->
            <!--onkeypress="if(event.keyCode == 13)document.getElementById('tesseraeform:fieldCommandButton').click();"-->
            <h:inputText id="fieldCommandArea"
                         value="#{tesseraemanager.inputMessage}"
                         autocomplete="off"
                         style="width:100%; text-align:center;"
            >
            </h:inputText>

            <!-- Send and help buttons -->
            <div align="center" style="margin: 5px 0 5px 0;">
                <p:commandButton id="fieldCommandButton"
                                 value="interpret command!"
                                 action="#{tesseraemanager.interpretCommand}"
                                 update="@form"

                >
                </p:commandButton>

                <p:commandButton id="helpButton"
                                 value="HELP"
                                 action="#{tesseraemanager.interpretHelp}"
                                 update="fieldMessageArea"
                />
            </div>

            <!-- Reply for the Player -->
            <p:inputTextarea id="fieldMessageArea"
                             value="#{tesseraemanager.lastMessage}"
                             readonly="true"
                             rows="1"
                             autoResize="true"
                             style="width:100%; text-align:center; border:none; background-color:paleturquoise; font-family:monospace; font-size:14px"
            />

        </h:form>
    </ui:define>

</ui:composition>
