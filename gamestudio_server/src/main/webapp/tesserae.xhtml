<ui:composition template="/WEB-INF/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:g="http://www.tuke.sk/games"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="javascript">
        <script type="text/javascript">
            //<![CDATA[
            //Actual life-hack, catch stack overflow
            try {
                $(document).ready(function () {
                    /*
                     $.ajax({
                     url: "webapi/score/mines",
                     }).done(function(json) {
                     for(var i = 0; i < json.length; i++) {
                     var score = json[i];
                     $("#scoreList").append($("<li>" + score.player + " " + score.points + " " + score.playedOn + "</li>"));
                     }
                     });
                     */
                });

                $(document).ready(function () {
                    $('#scoreTable').DataTable({
                        columns: [
                            {data: "player"},
                            {data: "points"},
                            {data: "playedOn"}
                        ],
                        ajax: {url: "webapi/score/mines", dataSrc: ''}
                    });

                    $('#favoriteGameTable').DataTable({
                        columns: [
                            {data: "player"},
                            {data: "game"},
                            {data: "chosenOn"}
                        ],
                        ajax: {
                            url: "webapi/favoritegame/player/" + "Steve"/*$('label#userName').getAttribute('value')*/,
                            dataSrc: ''
                        }
                    });

                    //Text areas will scale dynamically
                    autosize($('#fieldResultArea'));
                    autosize($('#fieldTextArea'));

                    //Autofocus for the input command area
                    window.onload = function () {
                        var cmds = document.getElementById("tesseraeform:fieldCommandArea");
                        cmds.focus();
                        cmds.setAttribute("value", "");
                        return "";
                    }
                });
            } catch (e) {
                //Actual life-hack, catch stack overflow
                window.location.replace("http://stackoverflow.com/search?q=[js] + " + e.message);
            }
            //]]>
        </script>
    </ui:define>

    <ui:define name="content">
        <!-- Tesserae -->
        <h1>Tesserae</h1>

        <h:form id="tesseraeform" style="margin: 30px 0 30px 0;">

            <g:tesserae textOnly="true" value="#{tesseraemanager}">
            </g:tesserae>

            <!-- Message from the Player -->
            <!--onkeypress="if(event.keyCode == 13)document.getElementById('tesseraeform:fieldCommandButton').click();"-->
            <h:inputText id="fieldCommandArea"
                         value="#{tesseraemanager.inputMessage}"
                         autocomplete="off"
                         style="width:100%; text-align:center;"
            >
            </h:inputText>

            <!-- Send and help buttons -->
            <div align="center" style="margin: 5px 0 5px 0;">
                <p:commandButton id="fieldCommandButton"
                                 value="interpret command!"
                                 action="#{tesseraemanager.interpretCommand}"
                                 update="@form"

                >
                </p:commandButton>

                <p:commandButton id="helpButton"
                                 value="HELP"
                                 action="#{tesseraemanager.interpretHelp}"
                                 update="fieldResultArea"
                />
            </div>

            <!-- Reply for the Player -->
            <p:inputTextarea id="fieldResultArea"
                             value="#{tesseraemanager.lastMessage}"
                             readonly="true"
                             rows="1"
                             autoResize="true"
                             style="width:100%; text-align:center; border:none; background-color:paleturquoise"
            />

        </h:form>
    </ui:define>

</ui:composition>
